define(["jquery","login/port","loginPort"],function(a,b,c){function d(b){a.post(b.auth_port,b,function(c){if("object"!=typeof c)try{c=a.parseJSON(c)}catch(d){return void alert("服务器数据异常，稍后再试")}if(c.success)if(c.nextSrc)"image"==b.auth_way&&a(".captcha-img").attr("src",c.nextSrc);else{alert("短信已经发送，请注意接收验证码"),h.attr("disabled","disabled");var e=30,f=h.text(),g=setInterval(function(){h.text(e--+"秒后可再发送"),1>e&&(h.text(f).removeAttr("disabled"),clearInterval(g))},1e3)}else!c.success&&c.errMsg&&alert(c.errMsg)})}function e(b){a(".u-error-tip").hide();var c=/(?:^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$)|(?:^[\d]{6,16})$/,d=/^[\d]{11}$/,e=o.find(".u-error-tip"),f=n.find(".u-error-tip"),g=q.find(".u-error-tip");if("normal"==i){if(!c.test(b.user_email))return f.show(),!1;if(f.hide(),b.user_psw.length<1)return e.show(),!1;if(e.hide(),4!=b.user_auth.length)return g.show(),!1;g.hide()}else if("mobile"==i){if(!d.test(b.user_email))return p.find(".u-error-tip").show(),!1;if(b.user_auth.length<1)return r.find(".u-error-tip").show(),!1}return!0}function f(d){a.ajax({url:b.login,type:"post",dataType:"json",data:d,success:function(b){if("object"!=typeof b)try{b=a.parseJSON(b)}catch(d){return void alert("服务器异常，稍后再试")}if(b.success)location.href=c.jump_port;else if(b.no||b.no>=1&&b.no<=4)switch(b.no){case 1:g(n,b.errMsg.inputMsg);break;case 2:g($divUserPWd,b.errMsg.inputMsg);break;case 3:!function(){"mobile"==i&&g(p,b.errMsg.inputMsg)}();break;case 4:!function(){"normal"==i?g(q,b.errMsg.inputMsg):"mobile"==i&&g(r,b.errMsg.inputMsg)}()}else b.errMsg&&b.errMsg.otherMsg&&alert(b.errMsg.otherMsg)}})}function g(a,b){var c=a.find(".u-error-tip");b&&c.text(b),c.show()}var h=a(".sms-btn");console.log(c),a(".captcha-img").on("click",function(){d({auth_way:"image",auth_port:b.image_auth})}),h.on("click",function(){d({auth_port:b.sms_auth,auth_way:"sms",timestemp:(new Date).getTime(),telNumber:a("#user-mobile").val()})}),a("#login-form input").on("focus",function(){a(".u-error-tip").hide()});var i="normal",j=a("#switch-mobile"),k=a("#switch-normal"),l=a(".js-mobile-wapper"),m=a(".js-normal-wapper");j.on("click",function(){a(this).hide(),k.show(),l.show(),m.hide(),i="mobile",a(".u-error-tip").hide()}),k.on("click",function(){a(this).hide(),j.show(),m.show(),l.hide(),i="normal",a(".u-error-tip").hide()});var n=a("#login-user-name"),o=a("#login-user-pwd"),p=a("#login-user-mobile"),q=a("#login-user-auth1"),r=a("#login-user-auth2");a("#login-form").on("submit",function(b){b.preventDefault();var c={login_way:i,user_psw:o.find("input").val(),user_remember:function(){return 1==a("#auto-login")[0].checked?!0:!1}(),user_email:function(){return"normal"==i?n.find("input").val():"mobile"==i?p.find("input").val():void 0}(),user_auth:function(){return"normal"==i?q.find("input").val():"mobile"==i?r.find("input").val():void 0}()};return e(c)?(f(c),!1):!1})});