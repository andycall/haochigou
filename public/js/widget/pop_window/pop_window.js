define(["jquery"],function(){function a(){$.get("/goods_comments",function(a){if("object"!=typeof a)try{a=$.parseJSON(a)}catch(c){return void alert("服务器数据错误")}"true"==a.success?b(a.nextSrc?a:a):a.errMsg&&alert(a.errMsg)})}function b(a){a.good_name=e.goodName;var b=_.template($("#drawer-temp").html())(a);$(".pop_inner").html(b)}function c(a){$.post("/collect",a,function(a){if("object"!=typeof a)try{a=$.parseJSON(a)}catch(b){return alert("服务器数据错误"),void $(".pop_window .u-favor").toggleClass("on")}if("true"==a.success){var c=$(".rst-aside-dish-item").eq(0).clone(!0);c.attr({"data-good-id":e.goodId,"data-shop-id":e.shopId}),c.find(".food_name").text(e.goodName),c.find(".symbol-rmb").text(e.goodPrice),h.find(".rst-aside-dish-item").eq(0).before(c)}else a.errMsg&&alert(a.errMsg)})}function d(a){$.post("/delCollect",a,function(b){if("object"!=typeof b)try{b=$.parseJSON(b)}catch(c){return alert("服务器数据错误"),void $(".pop_window .u-favor").toggleClass("on")}"true"==b.success?h.find(".rst-aside-dish-item").each(function(b,c){c=$(c),c.attr("data-good-id")==a.goodId&&c.attr("data-shop-id")==a.shopId&&c.find(".food_name").text()==a.goodName&&c.remove()}):b.errMsg&&alert(b.errMsg)})}console.log("pop windows loaded");var e={goodName:"",goodId:"",goodPrice:"",shopId:$(".pop_window .pop_inner").attr("data-shop-id")},f=$(".pop_window"),g=$(".u-mask");$(".js-open-pop-window").on("click",function(){var b=$(this);f.css("left","0px"),g.show();var c={good_id:b.parents(".js-get-good-id").attr("data-good_id")};e.goodId=c.good_id,e.goodName=b.parents(".menu_sec_status").siblings(".menu_sec_info").find(".menu_sec_desc").text(),e.goodPrice=b.parents(".menu_sec_status").siblings(".menu_sec_action").find(".symbol-rmb").text(),a(c)}),$(document).on("click",".js-close-pop-window, .u-mask",function(){f.css("left","-400px"),g.hide()});var h=$(".rst-aside-menu-list");$(".pop_window").on("click",".u-favor",function(){var a=$(this);a.toggleClass("on"),a.hasClass("on")?c(e):d(e)}),$(".pop_window").on("click","#btn-check",function(){})});