define(["jquery","tools/Sizer","underscore"],function(a,b,c){function d(d,e){var f,g,h,k={};if("checkbox"==e||"activity"==e){var l=d.delegateTarget,m=a(l).find("input");if(h=a(".drop_button").find("a").html(),m){var n=m[0].checked;m[0].checked=!n}"口味"!=h&&"全部"!=h&&(k.flavor=h)}else if("drop"==e){var o=d.target;h=a(o).html(),"口味"!=h&&"全部"!=h&&(k.flavor=h)}"checkbox"==e||"drop"==e?(f=a(".choice_click"),f.each(function(){var b=a(this).find("input"),c=a(this).find("label"),d=b[0].checked,e=(c.html(),a(this).data("label"));d&&(k[e]=Number(d))})):(f=a(".activities-btn"),g=[],f.each(function(){var b=a(this).find("input"),c=a(this).data("activity_id"),d=b[0].checked;d&&g.push(c)}),k.support_activity=g),console.log(k),console.log(b.get(k));var p=c.template(a("#shop_list_template").html())({shops:b.get(k),shop_activity:i});j.find("td").html(p)}var e=a(".drop_button"),f=a(".drop_list"),g=a(".activities-btn"),h=(a(".shops_func"),a(".choice_click")),i={},j=a(".shop_container");g.each(function(){var b=a(this).data("activity_id"),c=a(this).find("label").html();i[b]=c}),e.on("click",function(){return f.toggle(),a(this).toggleClass("active"),!1}),f.on("click","li",function(a){var b=a.currentTarget,c=b.innerHTML;e.find("a").html(c),f.toggle()}),function(){var c=j.find(".more_shops-row-book"),d=[];c.each(function(){var b=a(this),c=b.data("place_id"),e=b.data("shop_id"),f=b.data("flavor"),g=b.data("issupportpay"),h=b.data("isonline"),i=b.data("ishot"),j=b.data("support_activity").split(","),k=b.parent().prop("href"),l=b.find(".uncollect").hasClass("change"),m=b.find(".logo img").prop("src"),n=b.find(".more_shops-row-book-left span").data("deliver_time"),o=b.find(".title p").html(),p=b.find(".more_shops-row-book-right").data("is_opening"),q=b.find(".more_shops-row-book-right").data("shop_type"),r=b.find(".more_shops-row-book-right").data("shop_level"),s=b.find(".more_shops-row-book-right").data("order_count"),t=b.find(".divider").data("shop_announce"),u=b.find(".divider").data("deliver_state_start"),v=b.find(".divider").data("shop_address"),w=b.find(".divider").data("business_hours"),x=b.find(".divider").data("shop_summary"),y={};y.place_id=c,y.shop_id=e,y.flavor=f,y.issupportpay=g,y.isonline=h,y.ishot=i,y.support_activity=j,y.shop_id=e,y.shop_url=k,y.is_collected=l,y.shop_logo=m,y.deliver_time=n,y.shop_name=o,y.is_opening=p,y.shop_type=q,y.shop_level=r,y.order_count=s,y.shop_announce=t,y.deliver_state_start=u,y.shop_address=v,y.business_hours=w,y.shop_summary=x,d.push(y)}),console.log(d),b.add(d)}(),f.on("click","li",function(a){d(a,"drop")}),h.on("click",function(a){d(a,"checkbox")}),g.on("click",function(a){d(a,"activity")})});