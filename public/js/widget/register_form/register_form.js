define(["jquery","register/port","registerPort"],function(a,b,c){function d(b){a.post(b.auth_port,b,function(b){if("object"!=typeof b)try{b=a.parseJSON(b)}catch(c){return void alert("服务器数据异常，稍后再试")}if("true"==String(b.success)){alert("短信已经发送，请注意接收验证码"),g.attr("disabled","disabled");var d=30,e=g.text(),f=setInterval(function(){g.text(d--+"秒后可再发送"),1>d&&(g.text(e).removeAttr("disabled"),clearInterval(f))},1e3)}else!b.success&&b.errMsg&&alert(b.errMsg)})}function e(b){a(".u-error-tip").hide();var c=i.find(".u-error-tip"),d=h.find(".u-error-tip"),e=j.find(".u-error-tip"),f=l.find(".u-error-tip"),g=k.find(".u-error-tip"),m=/^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/,n=/^[a-z0-9A-Z]+$/,o=/^[\d]{11}$/,p=/^[\w]{6,20}$/;return console.log(b.user_phone),o.test(b.user_phone)?(d.hide(),m.test(b.user_email)?(g.hide(),p.test(b.user_psw)?(c.hide(),b.user_psw!=j.find("input").val()?(e.show(),!1):(e.hide(),n.test(b.user_auth)?(f.hide(),!0):(f.show(),!1))):(c.show(),!1)):(g.show(),!1)):(d.show(),!1)}function f(d){a.ajax({url:b.register,type:"post",dataType:"json",data:d,success:function(b){if("object"!=typeof b)try{b=a.parseJSON(b)}catch(d){return void alert("服务器异常，稍后再试")}if("true"==String(b.success))location.href=c.jump_port;else if(b.no||b.no>=1&&b.no<=4)switch(b.no){case 1:showInputError(k,b.errMsg.inputMsg);break;case 2:showInputError($divUserPWd,b.errMsg.inputMsg);break;case 3:!function(){"mobile"==loginWay&&showInputError($divUserTel,b.errMsg.inputMsg)}();break;case 4:!function(){"normal"==loginWay?showInputError($divAuth1,b.errMsg.inputMsg):"mobile"==loginWay&&showInputError($divAuth2,b.errMsg.inputMsg)}()}else b.errMsg&&b.errMsg.otherMsg&&alert(b.errMsg.otherMsg)}})}console.log("register loaded");var g=a(".sms-btn");g.on("click",function(){d({auth_port:b.sms_auth,auth_way:"sms",timestemp:(new Date).getTime(),telNumber:a("#register-user-mobile-input").val()})}),a("#register-form input").on("focus",function(){a(".u-error-tip").hide()});var h=a("#register-user-mobile"),i=a("#user-pwd"),j=a("#user-re-pwd"),k=a("#register-user-email"),l=a("#register-user-auth");a("#register-form").on("submit",function(a){a.preventDefault();var b={user_phone:h.find("input").val(),user_psw:i.find("input").val(),user_email:k.find("input").val(),user_auth:l.find("input").val()};return e(b)?(f(b),!1):!1})});