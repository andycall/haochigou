define(["jquery","tools/Sizer"],function(a,b){function c(c,d){var e,f,g,j={};if("checkbox"==d||"activity"==d){var k=c.delegateTarget,l=a(k).find("input");if(g=a(".drop_button").find("a").html(),l){var m=l[0].checked;l[0].checked=!m}"口味"!=g&&"全部"!=g&&(j.flavor=g)}else if("drop"==d){var n=c.target;g=a(n).html(),"口味"!=g&&"全部"!=g&&(j.flavor=g)}"checkbox"==d||"drop"==d?(e=a(".choice_click"),e.each(function(){var b=a(this).find("input"),c=a(this).find("label"),d=b[0].checked,e=(c.html(),a(this).data("label"));d&&(j[e]=Number(d))})):(e=a(".activities-btn"),f=[],e.each(function(){var b=a(this).find("input"),c=a(this).data("activity_id"),d=b[0].checked;d&&f.push(c)}),j.support_activity=f),console.log(j),console.log(b.get(j));var o=_.template(a("#shop_list_template").html())({shops:b.get(j),shop_activity:h});i.find("td").html(o)}var d=a(".drop_button"),e=a(".drop_list"),f=a(".activities-btn"),g=(a(".shops_func"),a(".choice_click")),h={},i=a(".shop_container");f.each(function(){var b=a(this).data("activity_id"),c=a(this).find("label").html();h[b]=c}),d.on("click",function(){return e.toggle(),a(this).toggleClass("active"),!1}),e.on("click","li",function(a){var b=a.currentTarget,c=b.innerHTML;d.find("a").html(c),e.toggle()}),function(){var c=i.find(".more_shops-row-book"),d=[];c.each(function(){var b=a(this),c=b.data("place_id"),e=b.data("shop_id"),f=b.data("flavor"),g=b.data("issupportpay"),h=b.data("isonline"),i=b.data("ishot"),j=b.data("support_activity").split(","),k=b.parent().prop("href"),l=b.find(".uncollect").hasClass("change"),m=b.find(".logo img").prop("src"),n=b.find(".more_shops-row-book-left span").data("deliver_time"),o=b.find(".title p").html(),p=b.find(".more_shops-row-book-right").data("is_opening"),q=b.find(".more_shops-row-book-right").data("shop_type"),r=b.find(".more_shops-row-book-right").data("shop_level"),s=b.find(".more_shops-row-book-right").data("order_count"),t=b.find(".divider").data("shop_announce"),u=b.find(".divider").data("deliver_state_start"),v=b.find(".divider").data("shop_address"),w=b.find(".divider").data("business_hours"),x=b.find(".divider").data("shop_summary"),y={};y.place_id=c,y.shop_id=e,y.flavor=f,y.issupportpay=g,y.isonline=h,y.ishot=i,y.support_activity=j,y.shop_id=e,y.shop_url=k,y.is_collected=l,y.shop_logo=m,y.deliver_time=n,y.shop_name=o,y.is_opening=p,y.shop_type=q,y.shop_level=r,y.order_count=s,y.shop_announce=t,y.deliver_state_start=u,y.shop_address=v,y.business_hours=w,y.shop_summary=x,d.push(y)}),console.log(d),b.add(d)}(),e.on("click","li",function(a){c(a,"drop")}),g.on("click",function(a){c(a,"checkbox")}),f.on("click",function(a){c(a,"activity")})});